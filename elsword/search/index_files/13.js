$(document).ready(function(){function t(t,a){var r={sells:[],buys:[],id:1};return $(".buy-list > .draggable-wrapper > .item-img").each(function(){r.buys.push($(this).attr("data-item-id"))}),$(".sell-list > .draggable-wrapper > .item-img").each(function(){r.sells.push($(this).attr("data-item-id"))}),"search"==t?(a=a||{},a.item=a.item||$(".item-pagination .active a").html()||1,a.trade=a.trade||$(".trade-pagination .active a").html()||1,"page-create"==$(".page").attr("id")?void $.get("../elsword/ajax/search?sells="+r.sells+"&buys="+r.buys+"&key="+$("#item-finder").val()+"&pi="+a.item,function(t){if(null==t.items)return void window.alert(t.split("<a href")[0]);if($(".item-pagination ul").empty(),t.pages>1){var i,r,n,o;for(o=a.item+2+(7-a.item>0?6-a.item:2),n=a.item-2-(a.item+6>t.pages?a.item+5-t.pages:2),r=1;r<=t.pages;r++)2>=r||r>t.pages-2||r>n&&o>r?(i=$("<li>"),r==a.item&&i.addClass("active"),i.append($("<a>").attr("href","#").html(r)),$(".item-pagination ul").append(i)):(r==o||r==n)&&$("<li>").append("<span>...</span>").appendTo($(".item-pagination ul"));e()}$(".item-found-list .draggable-wrapper").empty();for(var r=0;r<t.items.length;r++)0==$("#item-"+t.items[r].id).length&&$(".item-found-list .draggable-wrapper").append($("<div>").addClass("item-img").css({"background-image":"url(http://cdn.fjbgame.com/i/src/"+t.items[r].file_name+".jpg)"}).attr({title:t.items[r].name,"data-item-id":t.items[r].id}))}):void(window.location=$("#item-finder-form").attr("action")+"?sell="+r.sells.join("-")+"&buy="+r.buys.join("-")+"&search="+$("#item-finder").val().replace(" ","+")+"&page_item="+a.item+"&page_trade="+a.trade)):(null!=r.note&&r.note.length>500&&window.alert("The trade note is limited to 500 characters length"),r.note=$("#trade-note").val(),r._token=$("#form-logout input:last").val(),void $.post($("#create-trade-form").attr("action"),r,function(t){null!=t.created?window.location=$("#create-trade-form").attr("action")+"/../trade/"+t.created:(null!=t.err&&(t=t.err),window.alert(t.split("<a href")[0]),i=!1)}).error(function(t){window.alert("Silahkan login terlebih dahulu")}))}function e(){$(".finder-wrapper .pagination a").off().on("click",function(e){var a=["page-market","page-user"];if(-1==a.indexOf($(".page").attr("id"))){e.preventDefault();var i=parseInt($(this).html());t("search",{item:i})}})}function a(){$(".user-info .edit-profile-button").html("Edit"==$(".user-info .edit-profile-button").html()?"Batal Edit":"Edit"),$("#form-update-profile").toggle(400),$("#user-newpassword, #user-newpassword2, #user-oldpassword").val("")}e(),$(".draggable-wrapper").sortable({connectWith:".draggable-wrapper",receive:function(t,e){$(this).parent().hasClass("item-found-list")||Math.ceil($(".sell-list .draggable-wrapper").children().length/3)+Math.ceil($(".buy-list .draggable-wrapper").children().length/3)>8&&($(e.sender).sortable("cancel"),window.alert("Items in the "+($(this).parent().hasClass("sell-list")?"sell":"buy")+" basket is exceeding the maximum capacity."))},update:function(t,e){$(this).parent().hasClass("item-found-list")||($(this).children().length>0?$(this).siblings(".drag-note").hide():$(this).siblings(".drag-note").show(),$(this).css({height:53*Math.ceil(($(this).children().length+1)/5)+"px"}),$(".sell-list h4 span").html("("+$(".sell-list .draggable-wrapper").children().length+"/"+(24-3*Math.ceil($(".buy-list .draggable-wrapper").children().length/3))+")"),$(".buy-list h4 span").html("("+$(".buy-list .draggable-wrapper").children().length+"/"+(24-3*Math.ceil($(".sell-list .draggable-wrapper").children().length/3))+")"))}}),$(".item-hack").remove(),0!=$("#page-trade #trade-note").length&&$("#page-trade #trade-note").css({height:$("#trade-note")[0].scrollHeight+"px"}),$("#item-finder-form").on("submit",function(e){e.preventDefault(),t("search",{item:1})}),$(".form-complete-trade").on("submit",function(t){window.confirm("Do you wish to remove this trade?")||t.preventDefault()}),$("#search-trade-form").on("submit",function(e){e.preventDefault(),t("search",{trade:1})});var i=!1;$("#create-trade-form").on("submit",function(e){e.preventDefault(),i||t("create")}),$("#login-form").on("submit",function(t){t.preventDefault(),$("#login-password").val(CryptoJS.SHA3($("#login-password").val()).toString()),$(this).off("submit"),$(this).submit()}),$("#trade-note").on("keydown",function(t){var e=$("#trade-note").val().length;$(".note-counter").html(500-e),e>500?$(".note-counter").addClass("superwarn"):$(".note-counter").removeClass("superwarn")}),$("#page-trade a.edit-trade").on("click",function(t){t.preventDefault(),window.alert("Click on items you wish to mark as complete.\nYou can only edit once in every 30 minutes"),$(this).hide(),$(".item-img:not(.item-complete)").addClass("edit-mode"),$("#trade-note").show().removeAttr("readonly").addClass("edit-mode"),$(".note-counter").html(500-$("#trade-note").val().length).show(),$(".save-trade-note").show().off().on("click",function(t){t.preventDefault(),$.post($(".form-bump-trade").attr("action"),{trade_id:$(".trade-wrapper").attr("data-trade-id"),notes:$("#trade-note").val(),_token:$("#form-logout input:last").val()},function(t){return null!=t.err?void window.alert(t.err):($("#trade-note").attr("readonly",""),0==$("#trade-note").val().length&&$("#trade-note").hide(),$(".note-counter").hide(),$(".save-trade-note").hide(),$("a.edit-trade").show(),void $(".edit-mode").removeClass("edit-mode").off())})}),$(".item-img.edit-mode").off().on("click",function(t){var e=$(this);0==e.children().length&&window.confirm("Mark this item as complete?\nThis process can not be undone")&&(console.log(),$.post($(".form-bump-trade").attr("action"),{trade_id:$(".trade-wrapper").attr("data-trade-id"),item_id:$(this).attr("data-item-id"),cart:$(this).parent().parent().attr("class"),_token:$("#form-logout input:last").val()},function(t){null!=t.item&&(e.addClass("item-complete"),e.removeClass("edit-mode"))}))})}),$("form.form-bump-trade").on("submit",function(t){if(t.preventDefault(),$(this).children(".bump-button").hasClass("disabled"))return void window.alert("You can only bump a trade once every 30 minutes");if(window.confirm("Bump trade?")){var e={};$(this).children().each(function(){null!=$(this).attr("name")&&(e[$(this).attr("name")]=$(this).attr("value"))}),$.post($(this).attr("action"),e,function(t){null==t.err?window.location=t.redir:window.alert(t.err)})}}),$(".user-info .edit-profile-button").on("click",function(t){t.preventDefault(),a()}),$("#form-update-profile").on("submit",function(t){t.preventDefault();var e=$("#user-newpassword").val(),i=$("#user-oldpassword").val();e.length>0&&e.length<5?window.alert("New password minimum length is 5 characters\nOr left it blank if you do not want to update it"):e.length>0&&e==i?window.alert("Your new password is identical to your old one"):e!=$("#user-newpassword2").val()?window.alert("New passwords do not match"):$.post($(this).attr("action"),{oldpassword:CryptoJS.SHA3(i).toString(),newpassword:e.length<5?"":CryptoJS.SHA3(e).toString(),email:$("#user-email").val(),ajax:!0,_token:$("#form-logout input:last").val()},function(t){null!=t.err?window.alert(t.err):(window.alert("Your account has been updated"),a())})}),$("#form-disconnect-facebook").on("submit",function(t){window.confirm("Are you sure to disconnect your facebook account?")||t.preventDefault()}),1==$("#page-register, #page-forgot").length&&(1==$("#recaptcha").length&&Recaptcha.create("6LegX-oSAAAAANq3gALyhMuZ2KM-SMdCNJlVGVRD","recaptcha",{theme:"white"}),$("#form-register, #form-reset").on("submit",function(t){t.preventDefault();var e=$("#input-password").val(),a=$("#input-password-confirmation").val();e!=a?$(".msg-password").html("Passwords do not match"):e.length<5?$(".msg-password").html("Password minimum length is 5 characters"):($("#input-password").val(CryptoJS.SHA3(e).toString()),$("#input-password-confirmation").val(CryptoJS.SHA3(a).toString()),$(this).append("<input type='hidden' name='javascript' value='true'>"),$(this).off("submit"),$(this).submit())}),$("#form-forgot").on("submit",function(t){t.preventDefault(),""==$("#input-username").val()||""==$("#input-email").val()?$(".msg-forgot").html("Some field(s) in the form may not yet completed"):($(this).off("submit"),$(this).submit())})),$.ajaxSetup({cache:!0}),$.getScript("//connect.facebook.net/en_US/all.js",function(){FB.init({appId:"556404744440837",status:!0,cookie:!0,xfbml:!0})})});
